<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" 
          xmlns:poll="org.bigbluebutton.modules.polling.views.*"
          borderStyle="none" horizontalAlign="center"
          headerHeight="0" borderThicknessBottom="0" borderThicknessLeft="0"
          borderThicknessRight="0" borderThicknessTop="0"
          creationComplete="onCreationComplete()">
  <mx:Script>
    <![CDATA[
      import mx.events.ItemClickEvent;
      
      import org.bigbluebutton.core.UsersUtil;
      import org.bigbluebutton.modules.polling.events.PollEvent;
      import org.bigbluebutton.modules.polling.model.PollingViewModel;
      import org.bigbluebutton.modules.polling.events.PollResultWindowEvent;
      
      [Bindable] public var viewModel:PollingViewModel;
      [Bindable] public var pollID:String;
      [Bindable] private var _showStopButton:Boolean = false;
      
      private function onCreationComplete():void{
        setCurrentState("PieChart");
        if (UsersUtil.amIModerator() || UsersUtil.amIPresenter()) {
          _showStopButton = true;
        }
      }
      
      private function switchChart(event:ItemClickEvent):void {
        if (event.currentTarget.selectedValue == "piechart") {
          setCurrentState("PieChart");     
        } else if (event.currentTarget.selectedValue == "barchart") {
          setCurrentState("BarChart");
        } 
      }
      
      private function stop():void {
        btnStop.visible = false;
        dispatchEvent(new PollEvent(PollEvent.STOP_POLL, pollID));		
      }

      private function close():void {
        dispatchEvent(new PollResultWindowEvent()); 
      }
      
    ]]>
  </mx:Script>

  <mx:VBox id="resultsBox" horizontalAlign="center" width="100%" height="100%">
    <mx:HBox height="5%" width="100%" id="chartbox" horizontalAlign="center" borderThickness="1" borderStyle="solid">
      <mx:RadioButtonGroup id="charttype" selectedValue="piechart" itemClick="switchChart(event);"/>  
      <mx:RadioButton groupName="charttype" id="pieChart" label="Pie Chart" value="piechart" width="100" />
      <mx:RadioButton groupName="charttype" id="barChart" label="Bar Chart" value="barchart" width="100" />
    </mx:HBox>
    <mx:Spacer height="5"/>
    <mx:HBox height="5%" width="100%" horizontalAlign="right">
      <mx:Spacer width="5"/>
      <mx:Label text="Time remaining:" fontSize="12" styleName="micSettingsWindowTitleStyle" visible="false" />
      <mx:Spacer width="100%"/>
      <mx:Button id="btnStop" label="Stop Polling" visible="{_showStopButton}" click="stop()"/>
      <mx:Spacer width="5"/>
      <mx:Button id="btnClose" label="Close" click="close()"/>
      <mx:Spacer width="5"/>
    </mx:HBox>  
  </mx:VBox>
  
  <mx:states>
    <mx:State name="PieChart"  >
      <mx:AddChild relativeTo="{chartbox}" position="before" >
        <poll:DisplayResultPieChartPanel width="100%" height="80%" viewModel="{viewModel}" pollID="{pollID}" horizontalAlign="center"/>
      </mx:AddChild>
    </mx:State>
    <mx:State name="BarChart">
      <mx:AddChild relativeTo="{chartbox}" position="before">
        <poll:DisplayResultBarChartPanel width="100%" height="80%" viewModel="{viewModel}" pollID="{pollID}" horizontalAlign="center"/>
      </mx:AddChild>
    </mx:State>
  </mx:states>
</mx:Panel>
